<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {
        var dataUrl = ['http://localhost:8000/chart/google-chart-data/?start-day=2019-04-01&end-day=2019-04-29&datapoint=23-sam-Ismart-kWh', 'http://localhost:8000/chart/google-chart-data/?start-day=2019-04-01&end-day=2019-04-29&datapoint=23-sam-Ismart-kW_peak', 'http://localhost:8000/chart/google-chart-data/?start-day=2019-04-01&end-day=2019-04-29&datapoint=23-sam-Ismart-kVarh_lag'];
        // chartData1 = getjson(dataUrl);
        
        var chartDataFinal = {
          'cols': [
            {'id': 'timestamp', 'label': 'timestamp', 'type': 'date'}
          ],
          'rows': []
        };

        for (var i=0; i<dataUrl.length; i++) {
          chartData = getjson(dataUrl[i]);
          newCol = chartData['cols'][1];
          chartDataFinal['cols'].push(newCol);
          // console.log(chartData);
          if (i==0) {
            chartDataFinal['rows'].push(chartData['rows']);
          } else {
            for(k in chartData['rows']) {
              var data = chartData['rows'][k];
              // chartDataFinal['rows'][k].push(data);
              // var key = Object.keys(k);

              // console.log(data);
              // console.log(k);
              // console.log(chartDataFinal['rows'][0][k]);
              if (chartDataFinal['rows'][0][k]) {
                chartDataFinal['rows'][0][k].push(data[0]);
              } else {
                chartDataFinal['rows'][0][k] = data;
              };
            };
          };
        };
        // console.log(chartDataFinal);
        var chartData3 = {};
        chartData3['cols'] = chartDataFinal['cols'];
        chartData3['rows'] = [];
        for (k in chartDataFinal['rows'][0]) {
          newRow = {'c': [{'v': k}]};
          // console.log(k);
          // console.log(chartDataFinal['rows'][0][k]);
          for (v in chartDataFinal['rows'][0][k]) {
            newRow['c'].push({'v': chartDataFinal['rows'][0][k][v]});
            // console.log(chartDataFinal['rows'][0][k]);
          };
          chartData3['rows'].push(newRow);
        };
        console.log(chartDataFinal);
        console.log(chartData3);
        // chartData3['rows'] = 
        // Create the data table.
        var data = new google.visualization.DataTable(chartData3);

        // Set chart options
        var options = {
          'title': 'How Much Pizza I Ate Last Night',
          'width': 1000,
          'height': 800,
          crosshair: {
            trigger: 'both',
            orientation: 'vertical',
          },
        };

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }

      function getjson(url) {
        var resp = '';
        var xmlHttp ;
        xmlHttp = new XMLHttpRequest();
        if(xmlHttp != null) {
          xmlHttp.open("GET", url, false);
          xmlHttp.send(null);
          resp = JSON.parse(xmlHttp.responseText);
        };
        return resp;
      };
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
  </body>
</html>